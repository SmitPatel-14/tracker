<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>21 Day Focus Tracker</title>
    <link rel="manifest" href="manifest.json" />
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" type="image/png" href="gicon.png" />
  </head>
  <body>
    <div class="app">
      <img src="gicon.png" alt="Goal Icon" class="goal-icon" />
      <h1>21 Day Focus Tracker</h1>
      <div class="quote" id="quote"></div>

      <table class="tracker-table">
        <thead>
          <tr>
            <th>Day</th>
            <th>Wake Up Early</th>
            <th>Workout</th>
            <th>Read Book</th>
            <th>Less Social Media</th>
            <th>No PM</th>
          </tr>
        </thead>
        <tbody id="tracker-body"></tbody>
      </table>
    </div>

    <!-- ðŸ”˜ Install Button -->
    <button id="installBtn" style="display: none">Install App</button>

    <script>
      const goals = ["wakeup", "workout", "read", "lesssm", "nopm"];
      const tbody = document.getElementById("tracker-body");

      for (let i = 1; i <= 21; i++) {
        const row = document.createElement("tr");
        let rowHTML = `<td>Day ${i}</td>`;
        goals.forEach((goal) => {
          const id = `day${i}_${goal}`;
          const checked = localStorage.getItem(id) === "true" ? "checked" : "";
          rowHTML += `<td><input type="checkbox" id="${id}" ${checked}></td>`;
        });
        row.innerHTML = rowHTML;
        tbody.appendChild(row);
      }

      goals.forEach((goal) => {
        for (let i = 1; i <= 21; i++) {
          const id = `day${i}_${goal}`;
          document.getElementById(id).addEventListener("change", (e) => {
            localStorage.setItem(id, e.target.checked);
          });
        }
      });

      const quotes = [
        "Discipline is the bridge between goals and accomplishment.",
        "Push yourself, no one else is going to do it for you.",
        "The pain you feel today will be the strength you feel tomorrow.",
        "Small daily improvements lead to stunning results.",
        "Success is not for the lazy.",
      ];

      const quoteBox = document.getElementById("quote");
      function showRandomQuote() {
        const quote = quotes[Math.floor(Math.random() * quotes.length)];
        quoteBox.innerText = `"${quote}"`;
      }

      showRandomQuote();
      setInterval(showRandomQuote, 10000);
    </script>

    <!-- ðŸ§  Service Worker Registration -->
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("service-worker.js")
            .then((reg) => {
              console.log("Service Worker registered: ", reg.scope);
            })
            .catch((err) => {
              console.error("Service Worker registration failed: ", err);
            });
        });
      }
    </script>

    <!-- ðŸ“¦ PWA Install Button Script -->
    <script>
      let deferredPrompt;
      const installBtn = document.getElementById("installBtn");

      window.addEventListener("beforeinstallprompt", (e) => {
        e.preventDefault();
        deferredPrompt = e;
        installBtn.style.display = "block";

        installBtn.addEventListener("click", () => {
          installBtn.style.display = "none";
          deferredPrompt.prompt();
          deferredPrompt.userChoice.then((choiceResult) => {
            if (choiceResult.outcome === "accepted") {
              console.log("User accepted the install prompt");
            }
            deferredPrompt = null;
          });
        });
      });
    </script>
  </body>
</html>
